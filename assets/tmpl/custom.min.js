$(document).ready(function(){function q(a){i=a;var b=$("#includeclosed").is(":checked");$.getJSON(c+"issuesbyproject/?q="+a+"&c="+b,function(a){var b=[],e;$.each(a,function(a,d){e=d.Id;b.push(l({id:e,name:d.Name}))});b.length==1&&j(e);a.length!=0?$("#issues").html(""+b.join("")):$("#issues").html("No issues.")})}function j(a){f=a;$("#issueid").val(a);$.getJSON(c+"notesbyissue/?q="+a,function(a){var d=[];$.each(a,function(a,b){var c=b.Id,r=(b.Content+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1<br />$2");
d.push(s({id:c,content:r}))});$("#noteForm").show();a.length!=0?$("#notes").html(""+d.join("")):$("#notes").html("No notes.")})}function m(){var a=$("#includeclosed").is(":checked");$.getJSON(c+"allprojects/?c="+a,function(a){var d=[];$.each(a,function(a,b){d.push(n({id:b.Id,name:b.Name}))});a.length!=0?$("#projectspeople").html(""+d.join("")):$("#projectspeople").html("No projects.")})}function o(){var a=$("#includeclosed").is(":checked");$.getJSON(c+"allissues/?c="+a,function(a){var d=[],k,e;$.each(a,
function(a,b){k=b.Id;e=b.Name;d.push(l({id:k,name:e}))});d.length==1&&j(k);a.length!=0?$("#issues").html(""+d.join("")):$("#issues").html("No issues.")})}function g(){var a=$("#includeclosed").is(":checked"),b=encodeURIComponent($("#search").val());b==""?m():$.getJSON(c+"projectssearch/?q="+b+"&c="+a,function(a){var b=[],e,c;$.each(a,function(a,d){e=d.Id;c=d.Name;b.push(n({id:e,name:c}))});b.length==1&&(i=e);a.length!=0?$("#projectspeople").html(""+b.join("")):$("#projectspeople").html("No projects.")})}
function h(){var a=$("#includeclosed").is(":checked"),b=encodeURIComponent($("#search").val());b==""?o():$.getJSON(c+"issuessearch/?q="+b+"&c="+a,function(a){var b=[],e,c;$.each(a,function(a,d){e=d.Id;c=d.Name;b.push(l({id:e,name:c}))});b.length==1&&(f=e,j(e));a.length!=0?$("#issues").html(""+b.join("")):$("#issues").html("No issues.")})}var c=window.location.href,n=_.template('<li><a class="project" href="<%- id %>"><%- name %></a></li>'),l=_.template('<li><a class="issue" href="<%- id %>">#<%- id %> <%- name %></a></li>'),
s=_.template('<div class="well" href="<%- id %>"><%= content %></div>'),p=_.template('<div class="alert alert-error"><button type="button" class="close" data-dismiss="alert">&times;</button><%- message %></div>');m();o();$("#search").focus();var f=-1,i=-1;$(document).on("click",".issue",function(a){a.preventDefault();a=$(this).attr("href");$("#issues a").each(function(){$(this).removeClass("highlight-select")});$(this).addClass("highlight-select");j(a)});$(document).on("click",".project",function(a){a.preventDefault();
a=$(this).attr("href");$("#projectspeople a").each(function(){$(this).removeClass("highlight-select")});$(this).addClass("highlight-select");$("#issues").html("");$("#notes").html("");$("#noteForm").hide();q(a)});$("#includeclosed").change(function(){g();h()});$("#search").keyup(function(a,b){var d=null;return function(){var c=this,e=arguments;clearTimeout(d);d=setTimeout(function(){a.apply(c,e)},b)}}(function(){$("#notes").html("");$("#issues").html("");$("#noteForm").hide();g();h()},200));$("#addcomment").click(function(){$.ajax({type:"POST",
dataType:"json",url:c+"savenote/",data:{issueid:f,body:$("#noteData").val()},success:function(a){a.Success==!0&&(j(f),$("#noteData").val(""))}})});$("#createProject").click(function(){var a=$("#modalprojectname").val();$.ajax({type:"POST",dataType:"json",url:c+"saveproject/",data:{projectname:a},success:function(a){a.Success==!0?(g(),h(),$("#modalprojectname").val(""),$("#projectModal").modal("hide")):(a=p({message:a.Message}),$("#projectModalError").html(a))}})});$("#closeIssue").click(function(){$("#confirmCloseIssueModal").modal()});
$("#closeIssueConfirm").click(function(){$("#confirmCloseIssueModal").modal("hide");$.ajax({type:"POST",dataType:"json",url:c+"closeissue/",data:{issueid:f},success:function(a){a.Success==!0&&(f=-1,$("#notes").html(""),$("#noteForm").hide(),g(),h())}})});$("#projectModal").on("show",function(){$("#projectModalError").html("");$.getJSON(c+"allprojects/",function(a){var b=[];$.each(a,function(a,c){var e=c.Id,f=c.Name,g="";e==i&&(g="selected");b.push('<option value="'+e+'" '+g+">"+f+"</option>")});$("#closeprojectid").html(""+
b.join(""))})});$("#closeProject").click(function(){$.ajax({type:"POST",dataType:"json",url:c+"closeproject/",data:{projectid:$("#closeprojectid").val()},success:function(a){a.Success==!0&&($("#projectModal").modal("hide"),$("#myTab a:first").tab("show"),i=f=-1,$("#notes").html(""),$("#noteForm").hide(),g(),h())}})});$("#createIssue").click(function(){var a=$("#issueprojectid").val(),b=$("#issuename").val(),d=$("#issuecontent").val();$.ajax({type:"POST",dataType:"json",url:c+"saveissue/",data:{projectid:a,
issuename:b,issuecontent:d},success:function(a){a.Success==!0?($("#search").val("#"+a.Id),g(),h(),$("#issuename").val(""),$("#issuecontent").val(""),$("#issueModal").modal("hide")):(a=p({message:a.Message}),$("#issueModalError").html(a))}})});$("#issueModal").on("show",function(){$("#issueModalError").html("")});$("#issueModal").on("show",function(){var a=$("#includeclosed").is(":checked");$.getJSON(c+"allprojects/?c="+a,function(a){var c=[];$.each(a,function(a,b){var f=b.Id,g=b.Name,h="";f==i&&(h=
"selected");c.push('<option value="'+f+'" '+h+">"+g+"</option>")});$("#issueprojectid").html(""+c.join(""))})})});
